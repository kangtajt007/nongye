<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta charset="utf-8"/>
    <title>广东省农业气象业务系统-业务产品制作发布</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
    <!-- bootstrap & fontawesome -->
    <link rel="stylesheet" href="../css/bootstrap.css"/>
    <link rel="stylesheet" href="../css/font-awesome.css"/>
    <link rel="stylesheet" href="../css/main.css"/>
    <link rel="stylesheet" href="../css/chosen.css"/>
    <!-- page specific plugin styles -->
    <!-- text fonts -->
    <link rel="stylesheet" href="../css/ace-fonts.css"/>
    <link rel="stylesheet" href="../css/ui.jqgrid.css"/>
    <!-- ace styles -->
    <link rel="stylesheet" href="../css/ace.css" class="ace-main-stylesheet" id="main-ace-style"/>
    <!--[if lte IE 9]>
    <link rel="stylesheet" href="../css/ace-part2.css" class="ace-main-stylesheet"/>
    <![endif]-->
    <!--[if lte IE 9]>
    <link rel="stylesheet" href="../css/ace-ie.css"/>
    <![endif]-->
    <!--[if lte IE 8]>
    <script src="../js/html5shiv.js"></script>
    <script src="../js/respond.js"></script>
    <![endif]-->
</head>

<body class="no-skin">
<!-- #section:basics/navbar.layout -->
<div id="navbar" class="navbar navbar-default">
    <script type="text/javascript">
        try {
            ace.settings.check('navbar', 'fixed')
        } catch (e) {
        }
    </script>

    <div class="navbar-container" id="navbar-container">
        <div class="navbar-header pull-left">
            <a href="#" class="navbar-brand">
                <small>
                    <i class="fa fa-leaf"></i>
                    广东省农业气象业务系统
                </small>
            </a>
        </div>

        <div class="navbar-buttons navbar-header" role="navigation">
            <div class="widget-toolbar no-border" style="margin-top: 5px;margin-left: 200px;">
                <ul class="nav nav-tabs tab-color-blue" id="recent-tab">
                    <li class="">
                        <a href="index.html">首页</a>
                    </li>
                    <li class="">
                        <a href="climateStatis.html">气候统计</a>
                    </li>
                    <li class="">
                        <a href="disasterWarning.html">灾害预警</a>
                    </li>
                    <li class="">
                        <a href="agricMeteo.html">农气服务</a>
                    </li>
                    <li class="active">
                        <a href="productionRelease.html">业务产品制作发布</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

<div class="main-container" id="main-container">
    <!-- /section:basics/sidebar -->
    <div class="main-content">
        <div class="page-content">
            <div class="row">
                <div class="col-sm-12">
                    <div class="well">
                        <button class="btn btn-app btn-success btn-xs active" title="农业气象情报预报" rel-json="advices.json">
                            <i class="ace-icon fa fa-list-alt bigger-160"></i>
                            情报预报
                        </button>
                        <button class="btn btn-app btn-purple btn-xs" title="农用天气预报" rel-json="agricultural.json">
                            <i class="ace-icon fa fa-newspaper-o bigger-160"></i>
                            农用预报
                        </button>
                        <button class="btn btn-app btn-pink btn-xs" title="作物关键期气象服务" rel-json="critical.json">
                            <i class="ace-icon fa fa-vimeo-square bigger-160"></i>
                            关键期
                        </button>
                        <button class="btn btn-app btn-danger btn-xs" title="灾害专题" rel-json="disaster.json">
                            <i class="ace-icon fa fa-bolt bigger-160"></i>
                            灾害专题
                        </button>
                        <button class="btn btn-app btn-info btn-xs" title="台站农情" rel-json="station.json">
                            <i class="ace-icon fa fa-bank bigger-160"></i>
                            台站农情
                        </button>
                    </div>
                </div>
            </div>
            <div id="advices-container" class="row sub-container form-inline">
                <div class="widget-box widget-color-blue3">
                    <div class="widget-header">
                        <div class="widget-title">农业气象情报预报</div>
                    </div>
                    <div class="widget-body">
                        <div class="widget-main">
                            <table class="search-table">
                                <tr>
                                    <th width="100">签发单位:</th>
                                    <td width="200">
                                        <select name="issue-select" class="chosen-select">
                                            <option value="1">广东省气候中心</option>
                                            <option value="2">广州市气候与农业气象中心</option>
                                            <option value="2">国家气候中心</option>
                                        </select>
                                    </td>
                                    <th width="100">签发日期:</th>
                                    <td>
                                        <div class="input-group">
                                            <input class="form-control date-picker" type="text" data-date-format="yyyy-mm-dd">
                                            <span class="input-group-addon">
                                                <i class="fa fa-calendar bigger-110"></i>
                                            </span>
                                        </div>
                                    </td>
                                    <th width="100">制作:</th>
                                    <td>
                                        <select name="maker-select" class="chosen-select">
                                            <option value="1">广东省气候中心</option>
                                            <option value="2">广州市气候与农业气象中心</option>
                                            <option value="2">国家气候中心</option>
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <th>内容:</th>
                                    <td colspan="4"><input type="text" style="width: 500px;" placeholder="内容" /></td>
                                    <td>
                                        <button class="btn btn-sm btn-corner btn-success fa fa-search">查询</button>
                                        <button class="btn btn-sm btn-corner btn-info fa fa-plus">添加</button>
                                    </td>
                                </tr>
                            </table>
                            <div class="row" style="margin-top:10px;">
                                <table id="advicesTable"></table>
                                <div id="jqGridPager"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="hidden" id="add-data-container">
        <div class="row">
            <div class="well well-sm">当前日期：
                <span class="green">2015-9-18</span>旬报处于第9月中旬(2015-9-20至2015-9-30)，旬报上一报告周期是：
                <span class="red">第9月上旬(2015-9-1至2015-9-10)</span>
            </div>
            <div>
                <table class="table table-bordered">
                    <tr>
                        <th width="150" class="align-right align-middle">摘要</th>
                        <td>
                            <textarea class="form-control" placeholder="摘要"></textarea>
                        </td>
                    </tr>
                    <tr>
                        <th class="align-right align-middle">前期农业气候评价</th>
                        <td>
                            <textarea class="form-control" placeholder="前期农业气候评价"></textarea>
                        </td>
                    </tr>
                    <tr>
                        <th class="align-right align-middle">未来天气建议</th>
                        <td>
                            <textarea class="form-control" placeholder="未来天气建议"></textarea>
                        </td>
                    </tr>
                    <tr>
                        <th class="align-right align-middle">农业生产建议</th>
                        <td>
                            <textarea class="form-control" placeholder="农业生产建议"></textarea>
                        </td>
                    </tr>
                    <tr>
                        <th class="align-right align-middle">土壤水分分析</th>
                        <td>
                            <textarea class="form-control" placeholder="土壤水分分析"></textarea>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
</div>

<!--[if !IE]> -->
<script type="text/javascript">
    window.jQuery || document.write("<script src='../js/jquery.js'>" + "<" + "/script>");
</script>
<!-- <![endif]-->

<!--[if IE]>
<script type="text/javascript">
    window.jQuery || document.write("<script src='../js/jquery1x.js'>" + "<" + "/script>");
</script>
<![endif]-->
<script type="text/javascript">
    if ('ontouchstart' in document.documentElement) document.write("<script src='../js/jquery.mobile.custom.js'>" + "<" + "/script>");
</script>
<script src="../js/bootstrap.js"></script>
<!-- page specific plugin scripts -->
<!-- ace scripts -->
<script src="../js/ace/elements.scroller.js"></script>
<script src="../js/ace/elements.colorpicker.js"></script>
<script src="../js/ace/elements.fileinput.js"></script>
<script src="../js/ace/elements.typeahead.js"></script>
<script src="../js/ace/elements.wysiwyg.js"></script>
<script src="../js/ace/elements.spinner.js"></script>
<script src="../js/ace/elements.treeview.js"></script>
<script src="../js/ace/elements.wizard.js"></script>
<script src="../js/ace/elements.aside.js"></script>
<script src="../js/ace/ace.js"></script>
<script src="../js/ace/ace.ajax-content.js"></script>
<script src="../js/ace/ace.touch-drag.js"></script>
<script src="../js/ace/ace.sidebar.js"></script>
<script src="../js/ace/ace.sidebar-scroll-1.js"></script>
<script src="../js/ace/ace.submenu-hover.js"></script>
<script src="../js/ace/ace.widget-box.js"></script>
<script src="../js/ace/ace.settings.js"></script>
<script src="../js/ace/ace.settings-rtl.js"></script>
<script src="../js/ace/ace.settings-skin.js"></script>
<script src="../js/ace/ace.widget-on-reload.js"></script>
<script src="../js/ace/ace.searchbox-autocomplete.js"></script>

<script src="../js/bootstrap-datepicker.js"></script>
<script src="../js/jqGrid/jquery.jqGrid.src.js"></script>
<script src="../js/jqGrid/i18n/grid.locale-cn.js"></script>
<script src="../js/chosen.jquery.js"></script>
<script src="../js/bootstrap-dialog.min.js"></script>
<script>
    var relJson = "advices.json";
    $(function () {
        $(".date-picker").datepicker({
            autoclose: true,
            todayHighlight: true
        });

        $(".fa-plus").click(addUpdateData);

        $(".fa-search").click(function(){
            initTable(relJson);
        });

        $('.chosen-select').chosen();

        $(".tooltip-success").tooltip();

        $("button.btn-app").click(function(){
            var me = $(this), title = me.attr("title");
            relJson = me.attr("rel-json");
            $(".widget-title").html(title);
            initTable(relJson);
        });
        initTable(relJson);
    });

    function addUpdateData(data){
        BootstrapDialog.show({
            title: $(".widget-title").html(),
            message: $("#add-data-container").clone().removeClass("hidden"),
            closable:false,
            size:'size-wide',
            buttons: [{
                id: 'btn-ok',
                label: '确定',
                cssClass: 'btn btn-sm btn-corner btn-info fa fa-save',
                autospin: false,
                action: function(dialogRef){

                    $("#advicesTable").jqGrid("addRowData",6,{
                        "id":6,
                        "name": "农业气象旬报2015年第24期",
                        "memo": "8月下旬我省气温、降水正常，日照略偏少，旬前、中期多雷雨天气，后期转晴热。",
                        "publishDate": "2015-9-2",
                        "maker": "李慕华",
                        "issue": "郭援朝",
                        "issueUnit": "广东省气候中心"
                    });
                    dialogRef.close();
                }
            },
            {
                id: 'btn-cancel',
                label: '取消',
                cssClass: 'btn btn-sm btn-corner btn-default fa fa-undo',
                autospin: false,
                action: function(dialogRef){
                    dialogRef.close();
                }
            }]
        });
    }

    //初始化表格
    function initTable(relJson){
        //resize to fit page size
        $(window).on('resize.jqGrid', function () {
            $("#advicesTable").jqGrid('setGridWidth', $(".widget-main").width()-20);
        });
        var url = "../json/production/" + relJson;

        $("#advicesTable").jqGrid(
        {
            url:url,
            mtype:'GET',
            datatype:'json',
            width: 850,
            height:"auto",
            columnsresize: true,
            rownumbers: true,
            colModel: [
                { label: '文件名', name: 'name', width: 250,sortable:false,formatter:formatName, align: "center" },
                { label: '摘要', name: 'memo', width: 350,sortable:false ,formatter:formatMemo, align: "center" },
                { label: '发布日期', name: 'publishDate', width: 100,sortable:false , align: "center" },
                { label: '制作', name: 'maker', width: 120,sortable:false , align: "center" },
                { label: '签发', name: 'issue', width: 120,sortable:false , align: "center" },
                { label: '签发单位', name: 'issueUnit', width: 200,sortable:false, align: "center"  },
                { label: '操作', name: 'id', width: 250,formatter: formatTools,sortable:false, align: "center" }
            ],
            altRows: true,
            rowNum:10,
            pager: "#jqGridPager"
        });

        function formatName(cellValue, options, rowObject){
            var link = $('<a href="http://www.gdnw.net/Weather_Info/" target="_blank" class="blue"></a>');
            link.html(cellValue.length > 18?cellValue.substring(0,18)+"...":cellValue);
            return link[0].outerHTML;
        }

        function formatMemo(cellValue, options, rowObject){
            if(cellValue.length > 20){
                return cellValue.substring(0,20) + "...";
            }
            else{
                return cellValue;
            }
        }

        function formatTools(cellValue, options, rowObject){
            var html = '<div class="btn-group btn-corner"><button class="btn btn-sm btn-corner btn-success fa fa-edit" onclick="updateRow('+rowObject.id+')">编辑</button>'
                       +'<button class="btn btn-sm btn-corner btn-info fa fa-signal">签发</button>'
                       +'<button class="btn btn-sm btn-corner btn-danger fa fa-remove" onclick="removeRow('+rowObject.id+')">删除</button></div>';
            return html;
        }
        $("#advicesTable").trigger("reloadGrid");
        $(window).triggerHandler('resize.jqGrid');//trigger window resize to make the grid get the correct size
    }

    function removeRow(rowId){
        $("#advicesTable").jqGrid("delRowData",rowId);
    }

    function updateRow(rowId){
        addUpdateData();
    }
</script>
</body>
</html>