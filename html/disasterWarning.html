<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta charset="utf-8"/>
    <title>广东省农业气象业务系统-灾害预警</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
    <!-- bootstrap & fontawesome -->
    <link rel="stylesheet" href="../css/bootstrap.css"/>
    <link rel="stylesheet" href="../css/font-awesome.css"/>
    <link rel="stylesheet" href="../css/main.css"/>
    <!-- page specific plugin styles -->
    <!-- text fonts -->
    <link rel="stylesheet" href="../css/ace-fonts.css"/>
    <link rel="stylesheet" href="../css/ui.jqgrid.css"/>
    <link rel="stylesheet" href="../css/datepicker.css"/>

    <link rel="stylesheet" href="../css/daterangepicker.css"/>
    <link rel="stylesheet" href="../css/bootstrap-datetimepicker.css"/>

    <!-- ace styles -->
    <link rel="stylesheet" href="../css/ace.css" class="ace-main-stylesheet" id="main-ace-style"/>
    <!--[if lte IE 9]>
    <link rel="stylesheet" href="../css/ace-part2.css" class="ace-main-stylesheet"/>
    <![endif]-->
    <!--[if lte IE 9]>
    <link rel="stylesheet" href="../css/ace-ie.css"/>
    <![endif]-->
    <!--[if lte IE 8]>
    <script src="../js/html5shiv.js"></script>
    <script src="../js/respond.js"></script>
    <![endif]-->
    <style type="text/css">
        .tables-wrapper .row:first-child {
            background-color: #EFF3F8;
        }

        .tables-wrapper .row {
            margin: 0 !important;
        }
    </style>
</head>

<body class="no-skin">
<!-- #section:basics/navbar.layout -->
<div id="navbar" class="navbar navbar-default">
    <script type="text/javascript">
        try {
            ace.settings.check('navbar', 'fixed')
        } catch (e) {
        }
    </script>

    <div class="navbar-container" id="navbar-container">
        <div class="navbar-header pull-left">
            <a href="#" class="navbar-brand">
                <small>
                    <i class="fa fa-leaf"></i>
                    广东省农业气象业务系统
                </small>
            </a>
        </div>

        <div class="navbar-buttons navbar-header" role="navigation">
            <div class="widget-toolbar no-border" style="margin-top: 5px;margin-left: 200px;">
                <ul class="nav nav-tabs tab-color-blue" id="recent-tab">
                    <li class="">
                        <a href="index.html">首页</a>
                    </li>
                    <li class="">
                        <a href="climateStatis.html">气候统计</a>
                    </li>
                    <li class="active">
                        <a href="disasterWarning.html">灾害预警</a>
                    </li>
                    <li class="">
                        <a href="agricMeteo.html">农气服务</a>
                    </li>
                    <li class="">
                        <a href="productionRelease.html">业务产品制作发布</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

<div class="main-container" id="main-container">
    <!-- /section:basics/sidebar -->
    <div class="main-content">
        <div class="page-content">
            <div class="row">
                <div class="col-sm-12">
                    <div class="well">
                        <button class="btn btn-app btn-grey btn-xs" click-target="#background-container">
                            <i class="ace-icon fa fa-home bigger-160"></i>
                            首页
                        </button>
                        <button class="btn btn-app btn-warning btn-xs" click-target="#day-container" data-type="day">
                            <i class="ace-icon fa fa-sun-o bigger-160"></i>
                            逐日灾害
                        </button>
                        <button class="btn btn-app btn-info btn-xs" click-target="#time-container"  data-type="time">
                            <i class="ace-icon fa fa-life-ring bigger-160"></i>
                            任意时段
                        </button>
                    </div>
                </div>
            </div>
            <div id="background-container" class="row sub-container">
                <span class="profile-picture">
                    <img class="img-responsive"
                         alt="首页背景图" src="../css/image/background.jpg"></img>
                </span>
            </div>
            <!-- // 逐日资料 -->
            <div id="day-container" class="row sub-container form-inline hidden">
                <div class="widget-box widget-color-blue3">
                    <div class="widget-header">
                        <div class="widget-title">逐日资料</div>
                    </div>
                    <div class="widget-body">
                        <div class="widget-main">
                            <div class="row search-div alert-success">
                                <div class="col-sm-4">
                                    <div class="alert">
                                        <span class="badge badge-warning badge-left fly-badge">灾害种类</span>
                                        <div class="control-group">
                                            <div class="radio">
                                                <label>
                                                    <input name="form-field-radio-day" type="radio" class="ace" checked="checked" value="1">
                                                    <span class="lbl">干旱</span>
                                                </label>
                                            </div>

                                            <div class="radio">
                                                <label>
                                                    <input name="form-field-radio-day" type="radio" class="ace" value="2">
                                                    <span class="lbl">风灾</span>
                                                </label>
                                            </div>

                                            <div class="radio">
                                                <label>
                                                    <input name="form-field-radio-day" type="radio" class="ace" value="3">
                                                    <span class="lbl">洪涝</span>
                                                </label>
                                            </div>
                                            <div class="radio">
                                                <label>
                                                    <input name="form-field-radio-day" type="radio" class="ace" value="4">
                                                    <span class="lbl">龙舟水</span>
                                                </label>
                                            </div>
                                            <div class="radio">
                                                <label>
                                                    <input name="form-field-radio-day" type="radio" class="ace" value="5">
                                                    <span class="lbl">高温</span>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="control-group">
                                            <div class="radio">
                                                <label>
                                                    <input name="form-field-radio-day" type="radio" class="ace" value="6">
                                                    <span class="lbl">寒露风</span>
                                                </label>
                                            </div>

                                            <div class="radio">
                                                <label>
                                                    <input name="form-field-radio-day" type="radio" class="ace" value="7">
                                                    <span class="lbl">霜降风</span>
                                                </label>
                                            </div>

                                            <div class="radio">
                                                <label>
                                                    <input name="form-field-radio-day" type="radio" class="ace" value="8">
                                                    <span class="lbl">冬季寒害</span>
                                                </label>
                                            </div>

                                            <div class="radio">
                                                <label>
                                                    <input name="form-field-radio-day" type="radio" class="ace" value="9">
                                                    <span class="lbl">低温阴雨</span>
                                                </label>
                                            </div>

                                            <div class="radio">
                                                <label>
                                                    <input name="form-field-radio-day" type="radio" class="ace" value="10">
                                                    <span class="lbl">倒春寒</span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-2">
                                    <div class="alert alert-success">
                                        <span class="badge badge-warning badge-left fly-badge">显示字段</span>
	                                    	<select  id="form-field-select-day" class="form-control" multiple="multiple" style="width: 100%;height: 95px;">
	                                    	</select>
                                    </div>
                                </div>
                                <div class="col-sm-2">
                                    <div class="alert alert-success">
                                        <span class="badge badge-warning badge-left fly-badge">起止日期</span>
                                        <div class="input-group input-group-sm">
                                            <input class="form-control date-picker" id="startDate-day" type="text" data-date-format="yyyy-mm-dd"/>
                                            <span class="input-group-addon">
                                                <i class="fa fa-calendar bigger-110"></i>
                                            </span>
                                        </div>
                                        <div class="input-group input-group-sm">
                                            <input class="form-control date-picker" id="endDate-day" type="text" data-date-format="yyyy-mm-dd"/>
                                            <span class="input-group-addon">
                                                <i class="fa fa-calendar bigger-110"></i>
                                            </span>
                                        </div>
                                              <div style="margin-bottom: 11px;">&nbsp;</div>
                                    </div>
                                </div>
                                <div class="col-sm-1">
                                    <div class="alert">
                                        <span class="badge badge-warning badge-left fly-badge">预警等级</span>
                                        	0-正常  1-轻等 2-中等 3-重等 4-严重
                                    </div>
                                </div>
                                <div class="col-sm-3 function-div">
                                    <div>
                                        <label>
                                            <input name="switch-field-1" class="ace ace-switch ace-switch-2" type="checkbox">
                                            <span class="lbl"> 输出经纬度</span>
                                        </label>
                                    </div>
                                    <button class="btn btn-white btn-default btn-round  search-data" data-type="day">
                                        <i class="ace-icon fa fa-search blue"></i>
                                        数据查询
                                    </button>
                                    <button class="btn btn-white btn-default btn-round">
                                        <i class="ace-icon fa fa-map-marker green"></i>
                                        等值线图
                                    </button>
                                    <button class="btn btn-white btn-default btn-round">
                                        <i class="ace-icon fa fa-file-o red2"></i>
                                        保存结果
                                    </button>
                                </div>
                            </div>
                            <div class="row">
                            	<div id="data-grid-day"><div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
 			<!-- // 逐日资料 -->
 			
 	 			 <!-- //任意时段资料统计资料 -->
            <div id="time-container" class="row sub-container form-inline hidden">
                <div class="widget-box widget-color-blue3">
                    <div class="widget-header">
                        <div class="widget-title">任意时段资料统计</div>
                    </div>
                    <div class="widget-body">
                        <div class="widget-main">
                            <div class="row search-div alert-success">
                                <div class="col-sm-4">
                                    <div class="alert ">
                                        <span class="badge badge-warning badge-left fly-badge">要素选择</span>
                                     <div class="control-group">
                                            <div class="radio">
                                                <label>
                                                    <input name="form-field-radio-time" type="radio" class="ace" checked="checked" value="1">
                                                    <span class="lbl">干旱</span>
                                                </label>
                                            </div>

                                            <div class="radio">
                                                <label>
                                                    <input name="form-field-radio-time" type="radio" class="ace" value="2">
                                                    <span class="lbl">风灾</span>
                                                </label>
                                            </div>

                                            <div class="radio">
                                                <label>
                                                    <input name="form-field-radio-time" type="radio" class="ace" value="3">
                                                    <span class="lbl">洪涝</span>
                                                </label>
                                            </div>
                                            <div class="radio">
                                                <label>
                                                    <input name="form-field-radio-time" type="radio" class="ace" value="4">
                                                    <span class="lbl">龙舟水</span>
                                                </label>
                                            </div>
                                            <div class="radio">
                                                <label>
                                                    <input name="form-field-radio-time" type="radio" class="ace" value="5">
                                                    <span class="lbl">高温</span>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="control-group">
                                            <div class="radio">
                                                <label>
                                                    <input name="form-field-radio-time" type="radio" class="ace" value="6">
                                                    <span class="lbl">寒露风</span>
                                                </label>
                                            </div>

                                            <div class="radio">
                                                <label>
                                                    <input name="form-field-radio-time" type="radio" class="ace" value="7">
                                                    <span class="lbl">霜降风</span>
                                                </label>
                                            </div>

                                            <div class="radio">
                                                <label>
                                                    <input name="form-field-radio-time" type="radio" class="ace" value="8">
                                                    <span class="lbl">冬季寒害</span>
                                                </label>
                                            </div>

                                            <div class="radio">
                                                <label>
                                                    <input name="form-field-radio-time" type="radio" class="ace" value="9">
                                                    <span class="lbl">低温阴雨</span>
                                                </label>
                                            </div>

                                            <div class="radio">
                                                <label>
                                                    <input name="form-field-radio-time" type="radio" class="ace" value="10">
                                                    <span class="lbl">倒春寒</span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-2">
                                    <div class="alert">
                                        <span class="badge badge-warning badge-left fly-badge">统计功能选择</span>
                                			<div class="radio">
                                                <label>
                                                    <input name="form-field-select-time" value="1" type="radio" class="ace" checked="checked">
                                                    <span class="lbl">灾害过程概况</span>
                                                </label>
                                            </div>

                                            <div class="radio">
                                                <label>
                                                    <input name="form-field-select-time"  value="2"  type="radio" class="ace">
                                                    <span class="lbl">过程起止日期</span>
                                                </label>
                                            </div>

                                            
                                    </div>
                                </div>
                                <div class="col-sm-2">
                                    <div class="alert">
                                        <span class="badge badge-warning badge-left fly-badge">起止日期</span>
                                        <div class="input-group input-group-sm">
                                            <input class="form-control date-picker" id="startDate" type="text" data-date-format="yyyy-mm-dd"/>
                                            <span class="input-group-addon">
                                                <i class="fa fa-calendar bigger-110"></i>
                                            </span>
                                        </div>
                                        <div class="input-group input-group-sm">
                                            <input class="form-control date-picker" id="endDate" type="text" data-date-format="yyyy-mm-dd"/>
                                            <span class="input-group-addon">
                                                <i class="fa fa-calendar bigger-110"></i>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                  
                               <div class="col-sm-1">
                                    <div class="alert">
                                        <span class="badge badge-warning badge-left fly-badge">预警等级</span>
                                        	0-正常  1-轻等 2-中等 3-重等 4-严重
                                    </div>
                                </div>
                                <div class="col-sm-3 function-div">
                                    <div>
                                        <label>
                                            <input name="switch-field-1" class="ace ace-switch ace-switch-2" type="checkbox">
                                            <span class="lbl"> 输出经纬度</span>
                                        </label>
                                    </div>
                                    <button class="btn btn-white btn-default btn-round search-data" data-type="time">
                                        <i class="ace-icon fa fa-search blue"></i>
                                        数据查询
                                    </button>
                                    <button class="btn btn-white btn-default btn-round">
                                        <i class="ace-icon fa fa-map-marker green"></i>
                                        等值线图
                                    </button>
                                    <button class="btn btn-white btn-default btn-round">
                                        <i class="ace-icon fa fa-file-o red2"></i>
                                        保存结果
                                    </button>
                                </div>
                            </div>
                            <div class="row">
                            	<div id="data-grid-time"><div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
 	<!-- // end任意时段资料统计资料 -->
 	 		
</div>
</div>
</div>

<!--[if !IE]> -->
<script type="text/javascript">
    window.jQuery || document.write("<script src='../js/jquery.js'>" + "<" + "/script>");
</script>
<!-- <![endif]-->

<!--[if IE]>
<script type="text/javascript">
    window.jQuery || document.write("<script src='../js/jquery1x.js'>" + "<" + "/script>");
</script>
<![endif]-->
<script type="text/javascript">
    if ('ontouchstart' in document.documentElement) document.write("<script src='../js/jquery.mobile.custom.js'>" + "<" + "/script>");
</script>
<script src="../js/bootstrap.js"></script>
<!-- page specific plugin scripts -->

<!-- ace scripts -->
<script src="../js/ace/elements.scroller.js"></script>
<script src="../js/ace/elements.colorpicker.js"></script>
<script src="../js/ace/elements.fileinput.js"></script>
<script src="../js/ace/elements.typeahead.js"></script>
<script src="../js/ace/elements.wysiwyg.js"></script>
<script src="../js/ace/elements.spinner.js"></script>
<script src="../js/ace/elements.treeview.js"></script>
<script src="../js/ace/elements.wizard.js"></script>
<script src="../js/ace/elements.aside.js"></script>
<script src="../js/ace/ace.js"></script>
<script src="../js/ace/ace.ajax-content.js"></script>
<script src="../js/ace/ace.touch-drag.js"></script>
<script src="../js/ace/ace.sidebar.js"></script>
<script src="../js/ace/ace.sidebar-scroll-1.js"></script>
<script src="../js/ace/ace.submenu-hover.js"></script>
<script src="../js/ace/ace.widget-box.js"></script>
<script src="../js/ace/ace.settings.js"></script>
<script src="../js/ace/ace.settings-rtl.js"></script>
<script src="../js/ace/ace.settings-skin.js"></script>
<script src="../js/ace/ace.widget-on-reload.js"></script>
<script src="../js/ace/ace.searchbox-autocomplete.js"></script>
<script src="../js/date-time/moment.js"></script>

<script src="../js/bootstrap-datepicker.js"></script>

<script src="../js/jqGrid/jquery.jqGrid.src.js"></script>
<script src="../js/jqGrid/i18n/grid.locale-en.js"></script>
<script>

	var siteNos = ["57988","57989","57996"],siteNames = ["乐昌","仁化","南雄"];
    $(function () {
        //二级菜单切换
        $("button.btn-app").click(function(){
            var me = $(this), target = me.attr("click-target"),dataType=me.attr("data-type");
            $("div.sub-container").hide();
            $(target).removeClass("hidden").show();
            initTable(dataType);
        });
        
        $(".date-picker").datepicker({
            autoclose: true,
            todayHighlight: true
        });
        
        $(".search-data").click(function(){
        	var me = $(this);
        	initTable(me.attr("data-type"))
        });
        $('[name="form-field-radio-day"]').click(function(){
        	var me = $(this),val= me.val(),select = $('#form-field-select-day'),startDate='',endDate="";
        	select.empty();
        	
        	switch (val) {
        	case "1"://干旱
        		select.append("<option value='降水量' selected='selected'>降水量</option>")
        			.append("<option value='SAPI'>SAPI</option>")
        			.append("<option value='DI'>DI</option>")
        			.append("<option value='干旱等级'>干旱等级</option>");
        		startDate = moment().add(-10, 'd').format("YYYY-MM-DD");
       		 	endDate = moment().format("YYYY-MM-DD");
        		break;
          	case "2"://风灾
        		select.append("<option value='最大风速'  selected='selected'>最大风速</option>")
        			.append("<option value='风灾等级'>风灾等级</option>");
        		startDate = moment().add(-10, 'd').format("YYYY-MM-DD");
       		 	endDate = moment().format("YYYY-MM-DD");
        		break;
          	case "3"://洪涝
        		select.append("<option value='降水量'  selected='selected'>降水量</option>")
        			.append("<option value='洪涝等级'>洪涝等级</option>");
        		startDate = moment().add(-10, 'd').format("YYYY-MM-DD");
       		 	endDate = moment().format("YYYY-MM-DD");
        		break;
          	case "4"://龙舟
        		select.append("<option value='降水量'  selected='selected'>降水量</option>")
        			.append("<option value='龙舟水等级'>龙舟水等级</option>");
        		startDate = moment().format("YYYY-05-21");
       		 	endDate = moment().format("YYYY-06-20");
        		break;
          	case "5"://高温
        		select.append("<option value='最高气温'  selected='selected'>最高气温</option>")
        			.append("<option value='高温等级'>高温等级</option>");
        		startDate = moment().add(-10, 'd').format("YYYY-MM-DD");
       		 	endDate = moment().format("YYYY-MM-DD");
        		break;
          	case "6"://寒露风
        		select.append("<option value='平均气温'  selected='selected'>平均气温</option>")
        			.append("<option value='寒露风等级'>寒露风等级</option>");
        		startDate = moment().format("YYYY-09-21");
       		 	endDate = moment().format("YYYY-10-20");
        		break;
          	case "7"://霜降风
        		select.append("<option value='平均气温'  selected='selected'>平均气温</option>")
        			.append("<option value='霜降风等级'>霜降风等级</option>");
        		startDate = moment().format("YYYY-10-21");
       		 	endDate = moment().format("YYYY-11-20");
        		break;
          	case "8"://冬季寒害
        		select.append("<option value='过程降温'  selected='selected'>过程降温</option>")
        			.append("<option value='寒害等级'>寒害等级</option>");
        		startDate = moment().add(-1,'y').format("YYYY-11-21");
       		 	endDate = moment().format("YYYY-01-20");
        		break;
          	case "9"://低温阴雨
        		select.append("<option value='平均气温'  selected='selected'>平均气温</option>")
        			.append("<option value='日照时数'>日照时数</option>")
        			.append("<option value='低温阴雨等级'>低温阴雨等级</option>");
        		startDate = moment().format("YYYY-02-21");
       		 	endDate = moment().format("YYYY-03-20");
        		break;
        		
          	case "10"://倒春寒
        		select.append("<option value='平均气温'  selected='selected'>平均气温</option>")
    				.append("<option value='日照时数'>日照时数</option>")
        			.append("<option value='倒春寒等级'>干旱等级</option>");
         		startDate = moment().format("YYYY-03-21");
       		 	endDate = moment().format("YYYY-04-20");
        		break;
        	default:
        		break;
        	}
        	$('#startDate-day').val(startDate);
    		$('#endDate-day').val(endDate);
        });
        
        $('[name="form-field-radio-day"][checked]').click();
        //resize to fit page size
        $(window).on('resize.jqGrid', function () {
        	if( $('#grid-table-day').length >0)
           	 $('#grid-table-day').jqGrid('setGridWidth', $("#day-container  .search-div").width());
        	if( $('#grid-table-month').length >0)
              	 $('#grid-table-month').jqGrid('setGridWidth', $("#month-container .search-div").width());
        	if( $('#grid-table-time').length >0)
              	 $('#grid-table-time').jqGrid('setGridWidth', $("#time-container .search-div").width());
        	if( $('#grid-table-year').length >0)
             	 $('#grid-table-year').jqGrid('setGridWidth', $("#year-container .search-div").width());
        })

    });
    // 初始化逐日资料表格
  	function  initDayMonthResourceTable(type){
  		var dataGrid = 'data-grid-'+type,
		gridTable ='grid-table-'+type;
			$('#'+dataGrid).append('<table id="'+gridTable+'" style="height:1px;"></table>');
			var grid_selector = "#"+gridTable;
			
			
			var startDate = moment($('#'+type+'-container #startDate-'+type).val()),
				endDate = moment($('#'+type+'-container #endDate-'+type).val()),
				select = $("#form-field-select-"+type).val(),
			    days = endDate.diff(startDate) / 86400000,
			    dayAry = [],
			    grid_data = [],
			    colNames = ['站号', '站名'],
			    colModels = [
			                     {name: 'siteNo', index: 'siteNo', width: 60},
			                     {name: 'siteName', index: 'siteName'}
			                 ];
			
			 //获取时间数组   
			dayAry.push(startDate.format("MM-DD"));
			for (var i = 0; i < days; i++) {
			    var c = startDate.add(1, 'd');
			    dayAry.push(c.format("MM-DD"));
			}
			//设置自定义数据
			 var userData = {};
			 userData.siteNo = "";
			 userData.siteName = "平均值";
			 for (var i = 0; i < days + 1; i++) {
			     var c = dayAry[i];
			     userData[c] = "";
			 }
			 userData.avg = "";
			 userData.max = "";
			 userData.min = ""; 
			   
			
			var rowData =[];
			//设置展示数据
			for (var j = 0; j < siteNos.length; j++) {
				for (var k = 0; k < select.length; k++) {
				    var obj = {};
				    obj.siteNo = siteNos[j];
				    obj.siteName = siteNames[j];
				    obj.avg = "-9999";
				    obj.max = "-9999";
				    obj.min = "-9999";
				    for (var i = 0; i < days + 1; i++) {
				        var c = dayAry[i];
				        obj[c] = "-9999";
				    }
				    if(select.length > 1){
				    	obj.target = select[k];	
				    }
				    grid_data.push(obj)
				}
			}
			
			//设置展示列
			if(select.length > 1){
				colNames.push("指标名");
			}
			for (var i = 0; i < days + 1; i++) {
			    colNames.push(dayAry[i]);
			}
			colNames.push('平均值');
			colNames.push('最小值');
			colNames.push('最大值');
			
			//设置展示模型
			if(select.length > 1){
				colModels.push({name: 'target', index: 'target', width: 70});
			}
			for (var i = 0; i < days + 1; i++) {
			    var c = dayAry[i];
			    colModels.push({name: c, index: c, width: 70});
			}
			colModels.push({name: 'avg', index: 'avg', width: 50});
			colModels.push({name: 'max', index: 'max', width: 50});
			colModels.push({name: 'min', index: 'max', width: 50});
			
			//数据
			$(grid_selector).html();
			jQuery(grid_selector).jqGrid({
			    data: grid_data,
			    datatype: "local",
			    height: 220,
			    colNames: colNames,
			    colModel: colModels,
			    shrinkToFit: colModels.length > 10 ? false : true,
			    altRows: true,
			    //toppager: true,
			    rownumbers: true,
			    footerrow: true,
			    userData:userData,
			    userDataOnFooter: true, 
			    gridComplete: function () {
			        var footerTable = $("#"+dataGrid+" .ui-jqgrid-ftable"),tr = $(footerTable.find("tr")[0]),
			        data={
			        	siteName:"平均值",
			        	avg:days >0? "-9999":"",
			         	max:days >0? "-9999":"",
			        	min:days >0? "-9999":""};
			        footerTable.empty();
			      
			        for (var k = 0; k < select.length; k++) {
			        	  if(select.length > 1){
						    	data.target = select[k];	
						    }
			        	data["siteName"] = "平均值";
			        	handerRowTr(tr,footerTable,gridTable,data,days,dayAry);
			        	data["siteName"] = "最小值";
			        	handerRowTr(tr,footerTable,gridTable,data,days,dayAry);
			        	data["siteName"] = "最大值";
			        	handerRowTr(tr,footerTable,gridTable,data,days,dayAry);
		        		
		        	}
			    }
			});
			$(window).triggerHandler('resize.jqGrid');//trigger window resize to make the grid get the correct size
    }

  	 //初始化时段资料表格
  	function initTimeResourceTable(type){
  		var dataGrid = 'data-grid-'+type,
		gridTable ='grid-table-'+type;
			$('#'+dataGrid).append('<table id="'+gridTable+'" style="height:1px;"></table>');
			var grid_selector = "#"+gridTable;
			
			
			var startDate = moment($('#'+type+'-container #startDate').val()),
				endDate = moment($('#'+type+'-container #endDate').val()),
			    days = endDate.diff(startDate) / 86400000,
			    dayAry = [],
			    grid_data = [],
			    colNames = ['站号', '站名'],
			    colModels = [
			                     {name: 'siteNo', index: 'siteNo', width: 60},
			                     {name: 'siteName', index: 'siteName', width: 90}
			                 ];
			
			var val= $('[name="form-field-radio-time"]:checked').val(),select = $('[name="form-field-select-time"]:checked').val();
			var a = [],b=[];
			if(select == "1"){
			
        	switch (val) {
	        	case "1"://干旱
	        	
	        		a = ['轻等日数','中等日数','重等日数','总日数','最高灾害等级'];
	        		for (var i = 0; i < a.length; i++) {
	        			var o = {name: 'count'+i, index: 'count'+i, width: 70}
	        			b.push(o);
	        		}
	        		break;
	          	case "2"://风灾
	        		a = ['轻等日数','中等日数','重等日数','严重日数','总日数','最高灾害等级'];
	        		for (var i = 0; i < a.length; i++) {
	        			var o = {name: 'count'+i, index: 'count'+i, width: 70}
	        			b.push(o);
	        		}
	        		break;
	          	case "3"://洪涝
	          	case "4"://龙舟
	        		a = ['过程雨量','过程日数','轻等日数','中等日数','重等日数','总日数','最高灾害等级'];
	        		for (var i = 0; i < a.length; i++) {
	        			var o = {name: 'count'+i, index: 'count'+i, width: 70}
	        			b.push(o);
	        		}
	        		break;
	          	case "5"://高温
	          	case "6"://寒露风
	          	case "7"://霜降风
	          	case "8"://冬季寒害
	          	case "9"://低温阴雨
	          	case "10"://倒春寒
	          		a = ['过程日数','轻等日数','中等日数','重等日数','总日数','最高灾害等级'];
	        		for (var i = 0; i < a.length; i++) {
	        			var o = {name: 'count'+i, index: 'count'+i, width: 70}
	        			b.push(o);
	        		}
	        		break;
	        		break;
	        	}
		       	$.merge(colNames,a);
				$.merge(colModels,b);
			}else{
				a = ["开始时间","结束时间","灾害等级"];
				b = [{name: 'startDate', index: 'startDate', width: 70},
				     {name: 'endDate', index: 'endDate'+i, width: 70},
				     {name: 'level', index: 'level', width: 70}];
			  	$.merge(colNames,a);
				$.merge(colModels,b);
			}
		
			 //获取时间数组   
			dayAry.push(startDate.format("MM-DD"));
			for (var i = 0; i < days; i++) {
			    var c = startDate.add(1, 'd');
			    dayAry.push(c.format("MM-DD"));
			}
			//设置自定义数据
			 var userData = {};
			
			//设置展示数据
			if(days+1 >0 ){
				for (var j = 0; j < siteNos.length; j++) {
				    var obj = {};
				    obj.siteNo = siteNos[j];
				    obj.siteName =siteNames[j];
				    if(select == "1"){
					    for (var i = 0; i < colNames.length-2; i++) {
					        obj["count"+i] = "0";
					    }
				    }else{
				    	obj.startDate=dayAry[0];
				    	obj.endDate=dayAry[days];
				    	obj.level = "1";
				    }
			
				    grid_data.push(obj)
				}
			}
			
			
			//数据
			$(grid_selector).html();
			jQuery(grid_selector).jqGrid({
			    data: grid_data,
			    datatype: "local",
			    height: 220,
			    colNames: colNames,
			    colModel: colModels,
			    shrinkToFit: colModels.length > 10 ? false : true,
			    altRows: true,
			    //toppager: true,
			    rownumbers: true,
			    footerrow: true,
			    userData:userData,
			    userDataOnFooter: true, 
			    gridComplete: function () {
			    	 var footerTable = $("#"+dataGrid+" .ui-jqgrid-ftable"),tr = $(footerTable.find("tr")[0]),
				        data={
				        	siteName:"平均值"};
			    	   if(select == "1"){
				    		 for (var i = 0; i < colNames.length-2; i++) {
				    			 data["count"+i] =days >0? "0":"";
						    }
			    		 }else{
			    			 data.level ="1";
			    		 }
		    			 footerTable.empty();
		    			data["siteName"] = "灾害站平均值";
		    			handerRowTr(tr,footerTable,gridTable,data,days,dayAry);
		    			data["siteName"] = "灾害站最小值";
		    			handerRowTr(tr,footerTable,gridTable,data,days,dayAry);
		    			data["siteName"] = "灾害站最大值";
		    			handerRowTr(tr,footerTable,gridTable,data,days,dayAry);
		    			data["siteName"] = "所有站平均值";
		    			handerRowTr(tr,footerTable,gridTable,data,days,dayAry);
			    }
			});
			$(window).triggerHandler('resize.jqGrid');//trigger window resize to make the grid get the correct size
    }
	

    //初始化逐日资料表格
    function initTable(type){
    	if(!type)
    		return;
		
    	$('#data-grid-day').empty();
    	$('#data-grid-month').empty();
    	$('#data-grid-time').empty();
    	$('#data-grid-year').empty();
    	
    	if(type == 'day' || type == 'month')
    		initDayMonthResourceTable(type);
    	else if(type == 'time' )
    		initTimeResourceTable(type);
    	else
    		initYearResourceTable(type);
    }
    
    function handerRowTr(tr,footerTable,gridTable,data,days,dayAry){
    	var rowTr =tr.clone(true,true);
        handerData(rowTr,gridTable,data,days,dayAry);
		footerTable.append(rowTr);
    }
    
    function handerData(tr,gridTable,data,days,dayAry){
  	 	 $('[aria-describedby="'+gridTable+'_rn"]', tr).width("6px");
    	for(var i in data){
            $('[aria-describedby="'+gridTable+'_'+i+'"]', tr).html(data[i]);	
    	}
    	if(days >0){
    	    for (var i = 0; i < days + 1; i++) {
    	           $('[aria-describedby="'+gridTable+'_'+dayAry[i]+'"]', tr).html("-9999");;
    	        }
    	}
    }
</script>
</body>
</html>
